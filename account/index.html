<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account</title>
    <link rel="stylesheet" href="/assets/css/account.css">
</head>

<body>
    <div class="signinDiv">
        <h1>Sign in/up</h1>
        <p class="signinMsg" id="signinMsg">Please <a id="signinLink" href="https://qfyckizrmqicdmrzbgig.supabase.co/auth/v1/authorize?provider=github">sign in/up</a>.</p>
    </div>
<script type="module">
    const SUPABASE_URL = 'https://qfyckizrmqicdmrzbgig.supabase.co';
    // Make sure this is the full anon key in your repo — truncated keys will fail.
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFmeWNraXpybXFpY2RtcnpiZ2lnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMjg2OTMsImV4cCI6MjA4MDYwNDY5M30.DlqFtid6PHUB8cgBPWOtmr6fxmLX0YEO3qvJvzX8bFc';

    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.35.0/+esm';
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function checkLogin() {
        try {
            // If this page is the OAuth redirect callback, this will parse the URL and set session.
            // It is harmless if there's nothing to parse.
            await supabase.auth.getSessionFromUrl().catch(() => {});

            const { data, error } = await supabase.auth.getSession();
            if (error) {
                console.error('getSession error:', error);
            }

            const session = data?.session ?? null;
            const signinMsgEl = document.getElementById("signinMsg");
            const signinLinkEl = document.getElementById("signinLink");

            if (session) {
                const user = session.user;
                // show something more useful than just "Logged in"
                signinMsgEl.textContent = `Logged in as ${user.email ?? user.user_metadata?.full_name ?? user.id}`;
            } else {
                // not logged in — ensure link is present and correct
                const href = `${SUPABASE_URL}/auth/v1/authorize?provider=github`;
                if (signinLinkEl) signinLinkEl.href = href;
                signinMsgEl.innerHTML = `Please <a id="signinLink" href="${href}">sign in/up</a>.`;
            }
        } catch (err) {
            console.error('checkLogin error:', err);
        }
    }

    checkLogin();
</script>
</body>

</html>
